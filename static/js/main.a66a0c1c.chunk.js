(this["webpackJsonpviz-react"]=this["webpackJsonpviz-react"]||[]).push([[0],{247:function(e,t,a){e.exports={"events-table":"events-table_events-table__2LXrx"}},432:function(e,t,a){},437:function(e,t,a){"use strict";a.r(t);var n=a(43),c=a.n(n),o=a(52),s=a(111),l=a(15),i=a(258),r=a.n(i),j=a(128),d=a(246),b=a(454),O=a(448),p=a(452),u=a(444),h=a(440);const m=Object(b.a)("loadEventsRequest"),x=Object(b.a)("loadEventsSuccess"),v=Object(b.a)("loadEventsFailure"),y=Object(b.a)("editEvent"),C=Object(b.a)("deleteEvent"),g=Object(b.a)("addEvent");var f=Object(j.b)({isFetching:Object(O.a)({[m]:()=>!0,[Object(p.a)(x,v)]:()=>!1},!1),error:Object(O.a)({[m]:()=>null,[v]:(e,t)=>t},null),eventTypes:Object(O.a)({[x]:(e,t)=>t.payload.eventTypes},[]),persons:Object(O.a)({[x]:(e,t)=>t.payload.persons},[]),toponyms:Object(O.a)({[x]:(e,t)=>t.payload.toponyms},[]),events:Object(O.a)({[x]:(e,t)=>Object(u.a)(t.payload.events.map((e=>({...e,startDate:new Date(e.startDate),endDate:new Date(e.endDate)}))),(e=>e.endDate-e.startDate),"desc"),[y]:(e,t)=>e.map((e=>e.id===t.payload.id?t.payload:e)),[C]:(e,t)=>e.filter((e=>e.id!==t.payload.id)),[g]:(e,t)=>[...e,{...t.payload,id:Object(h.a)()}]},[])});const D=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||j.c;var w=Object(j.d)(f,D(Object(j.a)(d.a))),S=a(0),k=a(36),_=a(442),I=a(79),F=a(455),T=a(262),E=a(447),L=a(260),N=a(51),M=a(256),B=a.n(M),R=a(257),z=a.n(R);const P=e=>e.events,V=e=>e.toponyms,K=e=>e.persons,Y=e=>e.eventTypes,A="/editor";var J=a(453),U=a(443),X=a(247),H=a.n(X),q=a(10);const G=e=>e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"}),Q=e=>e.type,W=e=>e.map((e=>[e.surname,e.name,e.patron].filter(Boolean).join(" "))).join(", "),Z=e=>e.map((e=>e.name)).join(", "),$=(e,t)=>e.startDate-t.startDate,ee=(e,t)=>e.endDate-t.endDate,te={defaultPageSize:20,pageSizeOptions:[20,50,100],position:["bottomCenter"]};var ae=({events:e,eventTypes:t,onSelect:a,deleteRow:n})=>{const c=Object(S.useCallback)((e=>({onClick:a?()=>a(e):void 0})),[a]),o=Object(S.useMemo)((()=>t.map((e=>({value:e.id,text:e.type})))),[t]);return Object(q.jsxs)(U.a,{dataSource:e,rowKey:e=>e.id,onRow:c,pagination:te,className:H.a["events-table"],children:[Object(q.jsx)(U.a.Column,{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",width:"35%"}),Object(q.jsx)(U.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",dataIndex:"startDate",width:"10%",sorter:$,render:G}),Object(q.jsx)(U.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",dataIndex:"endDate",width:"10%",sorter:ee,render:G}),Object(q.jsx)(U.a.Column,{title:"\u0422\u0438\u043f",dataIndex:"type",width:"10%",filters:o,onFilter:(e,t)=>t.type.id===e,render:Q}),Object(q.jsx)(U.a.Column,{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",dataIndex:"persons",width:"15%",render:W}),Object(q.jsx)(U.a.Column,{title:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",dataIndex:"toponyms",width:"15%",render:Z}),Object(q.jsx)(U.a.Column,{title:"",render:(e,t)=>Object(q.jsx)(J.a,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onConfirm:e=>{e.stopPropagation(),n(t)},onCancel:e=>{e.stopPropagation()},okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442",children:Object(q.jsx)(N.a,{type:"link",onClick:e=>{e.stopPropagation()},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})})},"delete")]})},ne=a(189),ce=a(450),oe=a(252),se=a(446),le=a(71),ie=a.n(le),re=a(165),je=a(451),de=a(445);var be=({dateFormat:e="DD.MM.YYYY",...t})=>Object(q.jsx)(de.a,{format:e,...t}),Oe=a(146);const pe=e=>e.id,ue=e=>e.name,he=[];var me=({options:e=he,optionKeyFactory:t=pe,optionValueFactory:a=pe,optionNameFactory:n=ue,...c})=>Object(q.jsx)(Oe.a,{...c,children:e.map((e=>Object(q.jsx)(Oe.a.Option,{value:a(e),children:n(e)},t(e))))}),xe=a(449);const ve=[];var ye=({allOptions:e,value:t=ve,onChange:a,placeholder:n,count:c=5,optionKeyFactory:o=pe,optionValueFactory:s=pe,optionNameFactory:l=ue,...i})=>{const[r,j]=Object(S.useState)([]),d=Object(S.useCallback)(Object(je.a)((t=>{j(e.filter((e=>l(e).toLowerCase().includes(t.toLocaleLowerCase()))))}),300),[e]),b=Object(S.useCallback)((()=>{j([])}),[]),O=Object(S.useCallback)((e=>{j([]),a(e)}),[a]),p=Object(S.useMemo)((()=>t.map((t=>e.find((e=>s(e)===t))))),[e,t,s]),u=Object(S.useMemo)((()=>r.length?r.slice(0,c):Object(xe.a)([...e.slice(0,c),...p])),[e,c,r,p]),h=Object(S.useMemo)((()=>r.length?r.length-c:e.length-u.length),[e,c,r,u.length]);return Object(q.jsxs)(Oe.a,{...i,placeholder:n,mode:"multiple",filterOption:!1,onSearch:d,onChange:O,onBlur:b,value:t,children:[u.map((e=>Object(q.jsx)(Oe.a.Option,{value:s(e),children:l(e)},o(e)))),h>0&&Object(q.jsxs)(Oe.a.Option,{value:"__hidedOptionsCount__",disabled:!0,children:["\u0415\u0449\u0435 ",h," \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"]},"__hidedOptionsCount__")]})};const Ce=e=>({name:t,label:a,validate:n,allowNull:c=!0,format:o=re.a,parse:s=re.a,...l})=>Object(q.jsx)(ne.a,{name:t,format:o,parse:s,allowNull:c,validate:n,children:({input:{value:n,onChange:c,onBlur:o,onFocus:s},meta:{invalid:i,touched:r,error:j}})=>Object(q.jsx)(se.a.Item,{label:a,validateStatus:r&&i?"error":"success",help:r&&i?j:void 0,children:Object(q.jsx)(e,{name:t,value:n,onChange:c,onBlur:o,onFocus:s,...l})})}),ge=e=>function({debounceTimeout:t=300,onChange:a,value:n,...c}){const[o,s]=Object(S.useState)(n),l=Object(S.useCallback)(Object(je.a)((e=>{a(e)}),t),[]),i=Object(S.useCallback)((({target:{value:e}})=>{s(e),l(e)}),[l]);return Object(q.jsx)(e,{value:o,onChange:i,...c})},fe=(Ce(ge(L.a)),Ce(ge(L.a.TextArea))),De=Ce(be),we=Ce(me),Se=Ce(ye);var ke=a(441),_e=a(35);const Ie=e=>Object(ke.a)(e)||""===e||Object(_e.a)(e)&&0===e.length?"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e":void 0,Fe=(e,t)=>(a,n)=>a.isBefore(n[e],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(t):void 0,Te=(...e)=>(t,a,n)=>e.reduce(((e,c)=>e||c(t,a,n)),void 0),Ee=e=>e.type,Le=e=>[e.surname,e.name,e.patron].filter(Boolean).join(" "),Ne={name:null,startDate:null,endDate:null,type:null,toponyms:[],persons:[]};var Me=({onSubmit:e,onClose:t,title:a})=>{const n=Object(o.c)(Y),c=Object(o.c)(V),s=Object(o.c)(K),l=Object(o.c)(P),{id:i}=Object(k.j)();if(l.length<1)return Object(q.jsx)(ce.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(q.jsx)("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"},children:Object(q.jsx)(oe.a,{size:"large"})})});const r=l.find((e=>e.id===Number(i))),j=r?(e=>({...e,startDate:ie()(e.startDate),endDate:ie()(e.endDate)}))(r):Ne;return Object(q.jsx)(ce.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(q.jsx)(ne.b,{initialValues:j,onSubmit:t=>{e(t)},children:({handleSubmit:e})=>{return Object(q.jsxs)(se.a,{layout:"vertical",onFinish:e,children:[Object(q.jsx)(se.a.Item,{children:Object(q.jsx)(fe,{name:"name",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",rows:4,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",validate:Ie})}),Object(q.jsx)(se.a.Item,{children:Object(q.jsx)(De,{name:"startDate",label:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",validate:Te(Ie,(t="endDate",a="\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",(e,n)=>e.isAfter(n[t],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(a):void 0))})}),Object(q.jsx)(se.a.Item,{children:Object(q.jsx)(De,{name:"endDate",label:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",validate:Te(Ie,Fe("startDate","\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430"))})}),Object(q.jsx)(se.a.Item,{children:Object(q.jsx)(we,{name:"type",label:"\u0422\u0438\u043f",options:n,optionNameFactory:Ee,validate:Ie})}),Object(q.jsx)(se.a.Item,{children:Object(q.jsx)(Se,{name:"toponyms",label:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",allOptions:c,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043f\u043e\u043d\u0438\u043c\u044b"})}),Object(q.jsx)(se.a.Item,{children:Object(q.jsx)(Se,{name:"persons",label:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",allOptions:s,optionNameFactory:Le,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043b\u0438\u0446"})}),Object(q.jsx)("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"},children:Object(q.jsx)(N.a,{htmlType:"submit",type:"primary","data-id":"save-button",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]});var t,a}})})};const Be="".concat(A,"/add"),Re="".concat(A,"/edit/:id");var ze=()=>{const e=Object(o.b)(),t=Object(k.h)(),[a,n]=Object(S.useState)(""),c=Object(o.c)(Y),s=Object(o.c)(K),l=Object(o.c)(V),i=Object(o.c)(P),r=Object(S.useMemo)((()=>i.map((e=>({...e,type:c.find((t=>t.id===e.type)),persons:e.persons?e.persons.map((e=>s.find((t=>t.id===e)))):[],toponyms:e.toponyms?e.toponyms.map((e=>l.find((t=>t.id===e)))):[]}))).filter((e=>e.name.toLowerCase().includes(a.toLowerCase())))),[i,c,s,l,a]),j=Object(S.useCallback)((e=>{t.push(Object(k.f)(Re,{id:e.id}))}),[t]),d=Object(S.useCallback)((()=>{t.push(A)}),[t]),b=Object(S.useCallback)((t=>{e(y({...t,endDate:t.endDate.toDate(),startDate:t.startDate.toDate()})),d(),T.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e")}),[e,d]),O=Object(S.useCallback)((t=>{e(C(t))}),[e]),p=Object(S.useCallback)((t=>{e(g({...t,id:Object(h.a)(),endDate:t.endDate.toDate(),startDate:t.startDate.toDate()})),d(),T.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e")}),[d,e]),u=Object(S.useCallback)((()=>{t.push(Be)}),[t]),m=Object(S.useMemo)((()=>JSON.stringify({events:i,eventTypes:c,toponyms:l,persons:s})),[i,c,l,s]);return Object(q.jsxs)(_.a,{children:[Object(q.jsx)(E.a,{ghost:!1,title:Object(q.jsx)(L.a.Search,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430",onSearch:n,style:{width:400},"data-id":"search"}),extra:Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)(N.a,{"data-id":"export-button",download:"events.json",icon:Object(q.jsx)(B.a,{}),href:URL.createObjectURL(new Blob([m],{type:"application/json"})),children:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),Object(q.jsx)(N.a,{type:"primary",onClick:u,"data-id":"add-button",icon:Object(q.jsx)(z.a,{}),children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]})}),Object(q.jsxs)(_.a.Content,{children:[Object(q.jsx)(ae,{events:r,eventTypes:c,onSelect:j,deleteRow:O}),Object(q.jsx)(k.b,{path:Be,render:()=>Object(q.jsx)(Me,{onClose:d,onSubmit:p,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}),Object(q.jsx)(k.b,{path:Re,render:()=>Object(q.jsx)(Me,{onClose:d,onSubmit:b,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})})]})]})};const Pe=[A];var Ve=()=>{const[e,t]=Object(S.useState)(!0),a=Object(o.b)(),{pathname:n}=Object(k.i)(),c=Object(S.useMemo)((()=>[Pe.find((e=>e===n))]),[n]);return Object(S.useEffect)((()=>{a((async e=>{e(m());try{const t=await fetch("".concat("/Viz-react","/events.json")),a=await t.json();e(x(a))}catch(t){e(v(t))}}))}),[a]),Object(q.jsxs)(_.a,{style:{minHeight:"100vh"},hasSider:!0,children:[Object(q.jsx)(_.a.Sider,{theme:"dark",collapsible:!0,width:240,collapsed:e,onCollapse:t,style:{overflow:"auto",height:"100vh",position:"fixed",left:0},children:Object(q.jsx)(I.a,{theme:"dark",mode:"inline",selectedKeys:c,children:Object(q.jsx)(I.a.Item,{icon:Object(q.jsx)(F.a,{}),children:Object(q.jsx)(s.b,{to:A,children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445"})},A)})}),Object(q.jsx)(_.a,{style:{marginLeft:e?80:240,transition:"margin 0.2s"},children:Object(q.jsx)(_.a.Content,{children:Object(q.jsxs)(k.d,{children:[Object(q.jsx)(k.b,{path:A,component:ze}),Object(q.jsx)(k.a,{to:A})]})})})]})};a(432);c.a.render(Object(q.jsx)(s.a,{children:Object(q.jsx)(o.a,{store:w,children:Object(q.jsx)(l.a,{locale:r.a,children:Object(q.jsx)(Ve,{})})})}),document.getElementById("root"))}},[[437,1,2]]]);
//# sourceMappingURL=main.a66a0c1c.chunk.js.map