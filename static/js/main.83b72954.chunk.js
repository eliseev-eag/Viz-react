(this["webpackJsonpviz-react"]=this["webpackJsonpviz-react"]||[]).push([[0],{242:function(e,t,a){e.exports={"events-table":"events-table_events-table__2LXrx"}},427:function(e,t,a){},432:function(e,t,a){"use strict";a.r(t);var n=a(43),s=a.n(n),c=a(53),o=a(107),l=a(15),i=a(253),r=a.n(i),d=a(141),j=a(157),b=a(434),O=a(438);const p=Object(d.b)("events/fetchEvents",(async()=>{const e=await fetch("".concat("/Viz-react","/events.json"));return await e.json()})),u=Object(d.c)({initialState:{eventTypes:[],persons:[],toponyms:[],events:[]},name:"events",reducers:{editEvent:(e,t)=>{const{events:a}=e;for(const[n,s]of Object.entries(a))if(s.id===t.payload.id){a[n]=t.payload;break}},deleteEvent:(e,t)=>{e.events=e.events.filter((e=>e.id!==t.payload.id))},addEvent:(e,t)=>{e.events.push({...t.payload,id:Object(b.a)()})}},extraReducers(e){e.addCase(p.fulfilled,((e,t)=>{const{events:a,...n}=t.payload;return a.forEach((e=>{e.startDate=new Date(e.startDate),e.endDate=new Date(e.endDate)})),{...n,events:Object(O.a)(a,(e=>e.endDate-e.startDate),"desc")}}))}}),{addEvent:h,deleteEvent:m,editEvent:x}=u.actions,v=e=>e.events,y=e=>e.toponyms,C=e=>e.persons,f=e=>e.eventTypes,g=Object(j.a)(v,y,C,f,((e,t,a,n)=>e.map((e=>({...e,type:n.find((t=>t.id===e.type)),persons:e.persons?e.persons.map((e=>a.find((t=>t.id===e)))):[],toponyms:e.toponyms?e.toponyms.map((e=>t.find((t=>t.id===e)))):[]}))))),D=Object(j.a)(v,y,C,f,((e,t,a,n)=>({events:e,eventTypes:n,toponyms:t,persons:a})));var w=u.reducer;var k=Object(d.a)({reducer:w}),S=a(0),I=a(36),F=a(436),T=a(79),_=a(446),E=a(257),L=a(441),M=a(255),N=a(51),B=a(251),z=a.n(B),R=a(252),K=a.n(R);const P="/editor";var V=a(445),Y=a(437),A=a(242),J=a.n(A),H=a(10);const U=e=>e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"}),X=e=>e.type,q=e=>e.map((e=>[e.surname,e.name,e.patron].filter(Boolean).join(" "))).join(", "),G=e=>e.map((e=>e.name)).join(", "),Q=(e,t)=>e.startDate-t.startDate,W=(e,t)=>e.endDate-t.endDate,Z={defaultPageSize:20,pageSizeOptions:[20,50,100],position:["bottomCenter"]};var $=({events:e,eventTypes:t,onSelect:a,deleteRow:n})=>{const s=Object(S.useCallback)((e=>({onClick:a?()=>a(e):void 0})),[a]),c=Object(S.useMemo)((()=>t.map((e=>({value:e.id,text:e.type})))),[t]);return Object(H.jsxs)(Y.a,{dataSource:e,rowKey:e=>e.id,onRow:s,pagination:Z,className:J.a["events-table"],children:[Object(H.jsx)(Y.a.Column,{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",width:"35%"}),Object(H.jsx)(Y.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",dataIndex:"startDate",width:"10%",sorter:Q,render:U}),Object(H.jsx)(Y.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",dataIndex:"endDate",width:"10%",sorter:W,render:U}),Object(H.jsx)(Y.a.Column,{title:"\u0422\u0438\u043f",dataIndex:"type",width:"10%",filters:c,onFilter:(e,t)=>t.type.id===e,render:X}),Object(H.jsx)(Y.a.Column,{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",dataIndex:"persons",width:"15%",render:q}),Object(H.jsx)(Y.a.Column,{title:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",dataIndex:"toponyms",width:"15%",render:G}),Object(H.jsx)(Y.a.Column,{title:"",render:(e,t)=>Object(H.jsx)(V.a,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onConfirm:e=>{e.stopPropagation(),n(t)},onCancel:e=>{e.stopPropagation()},okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442",children:Object(H.jsx)(N.a,{type:"link",onClick:e=>{e.stopPropagation()},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})})},"delete")]})},ee=a(185),te=a(443),ae=a(247),ne=a(440),se=a(71),ce=a.n(se),oe=a(161),le=a(444),ie=a(439);var re=({dateFormat:e="DD.MM.YYYY",...t})=>Object(H.jsx)(ie.a,{format:e,...t}),de=a(140);const je=e=>e.id,be=e=>e.name,Oe=[];var pe=({options:e=Oe,optionKeyFactory:t=je,optionValueFactory:a=je,optionNameFactory:n=be,...s})=>Object(H.jsx)(de.a,{...s,children:e.map((e=>Object(H.jsx)(de.a.Option,{value:a(e),children:n(e)},t(e))))}),ue=a(442);const he=[];var me=({allOptions:e,value:t=he,onChange:a,placeholder:n,count:s=5,optionKeyFactory:c=je,optionValueFactory:o=je,optionNameFactory:l=be,...i})=>{const[r,d]=Object(S.useState)([]),j=Object(S.useCallback)(Object(le.a)((t=>{d(e.filter((e=>l(e).toLowerCase().includes(t.toLocaleLowerCase()))))}),300),[e]),b=Object(S.useCallback)((()=>{d([])}),[]),O=Object(S.useCallback)((e=>{d([]),a(e)}),[a]),p=Object(S.useMemo)((()=>t.map((t=>e.find((e=>o(e)===t))))),[e,t,o]),u=Object(S.useMemo)((()=>r.length?r.slice(0,s):Object(ue.a)([...e.slice(0,s),...p])),[e,s,r,p]),h=Object(S.useMemo)((()=>r.length?r.length-s:e.length-u.length),[e,s,r,u.length]);return Object(H.jsxs)(de.a,{...i,placeholder:n,mode:"multiple",filterOption:!1,onSearch:j,onChange:O,onBlur:b,value:t,children:[u.map((e=>Object(H.jsx)(de.a.Option,{value:o(e),children:l(e)},c(e)))),h>0&&Object(H.jsxs)(de.a.Option,{value:"__hidedOptionsCount__",disabled:!0,children:["\u0415\u0449\u0435 ",h," \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"]},"__hidedOptionsCount__")]})};const xe=e=>({name:t,label:a,validate:n,allowNull:s=!0,format:c=oe.a,parse:o=oe.a,...l})=>Object(H.jsx)(ee.a,{name:t,format:c,parse:o,allowNull:s,validate:n,children:({input:{value:n,onChange:s,onBlur:c,onFocus:o},meta:{invalid:i,touched:r,error:d}})=>Object(H.jsx)(ne.a.Item,{label:a,validateStatus:r&&i?"error":"success",help:r&&i?d:void 0,children:Object(H.jsx)(e,{name:t,value:n,onChange:s,onBlur:c,onFocus:o,...l})})}),ve=e=>function({debounceTimeout:t=300,onChange:a,value:n,...s}){const[c,o]=Object(S.useState)(n),l=Object(S.useCallback)(Object(le.a)((e=>{a(e)}),t),[]),i=Object(S.useCallback)((({target:{value:e}})=>{o(e),l(e)}),[l]);return Object(H.jsx)(e,{value:c,onChange:i,...s})},ye=(xe(ve(M.a)),xe(ve(M.a.TextArea))),Ce=xe(re),fe=xe(pe),ge=xe(me);var De=a(435),we=a(35);const ke=e=>Object(De.a)(e)||""===e||Object(we.a)(e)&&0===e.length?"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e":void 0,Se=(e,t)=>(a,n)=>a.isBefore(n[e],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(t):void 0,Ie=(...e)=>(t,a,n)=>e.reduce(((e,s)=>e||s(t,a,n)),void 0),Fe=e=>e.type,Te=e=>[e.surname,e.name,e.patron].filter(Boolean).join(" "),_e={name:null,startDate:null,endDate:null,type:null,toponyms:[],persons:[]};var Ee=({onSubmit:e,onClose:t,title:a})=>{const n=Object(c.c)(f),s=Object(c.c)(y),o=Object(c.c)(C),l=Object(c.c)(v),{id:i}=Object(I.j)();if(l.length<1)return Object(H.jsx)(te.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(H.jsx)("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"},children:Object(H.jsx)(ae.a,{size:"large"})})});const r=l.find((e=>e.id===Number(i))),d=r?(e=>({...e,startDate:ce()(e.startDate),endDate:ce()(e.endDate)}))(r):_e;return Object(H.jsx)(te.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(H.jsx)(ee.b,{initialValues:d,onSubmit:t=>{e(t)},children:({handleSubmit:e})=>{return Object(H.jsxs)(ne.a,{layout:"vertical",onFinish:e,children:[Object(H.jsx)(ne.a.Item,{children:Object(H.jsx)(ye,{name:"name",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",rows:4,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",validate:ke})}),Object(H.jsx)(ne.a.Item,{children:Object(H.jsx)(Ce,{name:"startDate",label:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",validate:Ie(ke,(t="endDate",a="\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",(e,n)=>e.isAfter(n[t],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(a):void 0))})}),Object(H.jsx)(ne.a.Item,{children:Object(H.jsx)(Ce,{name:"endDate",label:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",validate:Ie(ke,Se("startDate","\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430"))})}),Object(H.jsx)(ne.a.Item,{children:Object(H.jsx)(fe,{name:"type",label:"\u0422\u0438\u043f",options:n,optionNameFactory:Fe,validate:ke})}),Object(H.jsx)(ne.a.Item,{children:Object(H.jsx)(ge,{name:"toponyms",label:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",allOptions:s,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043f\u043e\u043d\u0438\u043c\u044b"})}),Object(H.jsx)(ne.a.Item,{children:Object(H.jsx)(ge,{name:"persons",label:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",allOptions:o,optionNameFactory:Te,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043b\u0438\u0446"})}),Object(H.jsx)("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"},children:Object(H.jsx)(N.a,{htmlType:"submit",type:"primary","data-id":"save-button",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]});var t,a}})})};const Le="".concat(P,"/add"),Me="".concat(P,"/edit/:id");var Ne=()=>{const e=Object(c.b)(),t=Object(I.h)(),[a,n]=Object(S.useState)(""),s=Object(c.c)(f),o=Object(c.c)(D),l=Object(c.c)(g),i=Object(S.useMemo)((()=>l.filter((e=>e.name.toLowerCase().includes(a.toLowerCase())))),[l,a]),r=Object(S.useCallback)((e=>{t.push(Object(I.f)(Me,{id:e.id}))}),[t]),d=Object(S.useCallback)((()=>{t.push(P)}),[t]),j=Object(S.useCallback)((t=>{e(x({...t,endDate:t.endDate.toDate(),startDate:t.startDate.toDate()})),d(),E.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e")}),[e,d]),O=Object(S.useCallback)((t=>{e(m(t))}),[e]),p=Object(S.useCallback)((t=>{e(h({...t,id:Object(b.a)(),endDate:t.endDate.toDate(),startDate:t.startDate.toDate()})),d(),E.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e")}),[d,e]),u=Object(S.useCallback)((()=>{t.push(Le)}),[t]),v=Object(S.useMemo)((()=>JSON.stringify(o)),[o]);return Object(H.jsxs)(F.a,{children:[Object(H.jsx)(L.a,{ghost:!1,title:Object(H.jsx)(M.a.Search,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430",onSearch:n,style:{width:400},"data-id":"search"}),extra:Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)(N.a,{"data-id":"export-button",download:"events.json",icon:Object(H.jsx)(z.a,{}),href:URL.createObjectURL(new Blob([v],{type:"application/json"})),children:"\u042d\u043a\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),Object(H.jsx)(N.a,{type:"primary",onClick:u,"data-id":"add-button",icon:Object(H.jsx)(K.a,{}),children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]})}),Object(H.jsxs)(F.a.Content,{children:[Object(H.jsx)($,{events:i,eventTypes:s,onSelect:r,deleteRow:O}),Object(H.jsx)(I.b,{path:Le,render:()=>Object(H.jsx)(Ee,{onClose:d,onSubmit:p,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}),Object(H.jsx)(I.b,{path:Me,render:()=>Object(H.jsx)(Ee,{onClose:d,onSubmit:j,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})})]})]})};const Be=[P];var ze=()=>{const[e,t]=Object(S.useState)(!0),a=Object(c.b)(),{pathname:n}=Object(I.i)(),s=Object(S.useMemo)((()=>[Be.find((e=>e===n))]),[n]);return Object(S.useEffect)((()=>{a(p())}),[a]),Object(H.jsxs)(F.a,{style:{minHeight:"100vh"},hasSider:!0,children:[Object(H.jsx)(F.a.Sider,{theme:"dark",collapsible:!0,width:240,collapsed:e,onCollapse:t,style:{overflow:"auto",height:"100vh",position:"fixed",left:0},children:Object(H.jsx)(T.a,{theme:"dark",mode:"inline",selectedKeys:s,children:Object(H.jsx)(T.a.Item,{icon:Object(H.jsx)(_.a,{}),children:Object(H.jsx)(o.b,{to:P,children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445"})},P)})}),Object(H.jsx)(F.a,{style:{marginLeft:e?80:240,transition:"margin 0.2s"},children:Object(H.jsx)(F.a.Content,{children:Object(H.jsxs)(I.d,{children:[Object(H.jsx)(I.b,{path:P,component:Ne}),Object(H.jsx)(I.a,{to:P})]})})})]})};a(427);s.a.render(Object(H.jsx)(o.a,{children:Object(H.jsx)(c.a,{store:k,children:Object(H.jsx)(l.a,{locale:r.a,children:Object(H.jsx)(ze,{})})})}),document.getElementById("root"))}},[[432,1,2]]]);
//# sourceMappingURL=main.83b72954.chunk.js.map