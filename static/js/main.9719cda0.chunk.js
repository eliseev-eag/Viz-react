(this["webpackJsonpviz-react"]=this["webpackJsonpviz-react"]||[]).push([[0],{483:function(e,t,n){},484:function(e,t,n){"use strict";n.r(t);var a=n(40),c=n.n(a),r=n(30),o=n(104),i=n(97),s=n(269),u=n(153),l=n(36),j=n(226),d=n.n(j),b=n(270),O=n(503),p=n(496),f=n(501),h=n(492),m=n(487),x=Object(O.a)("loadEventsRequest"),v=Object(O.a)("loadEventsSuccess"),y=Object(O.a)("loadEventsFailure"),g=Object(O.a)("editEvent"),C=Object(O.a)("deleteEvent"),D=Object(O.a)("addEvent"),w=Object(i.c)({isFetching:Object(p.a)({[x]:function(){return!0},[Object(f.a)(v,y)]:function(){return!1}},!1),error:Object(p.a)({[x]:function(){return null},[y]:function(e,t){return t}},null),eventTypes:Object(p.a)({[v]:function(e,t){return t.payload.eventTypes}},[]),persons:Object(p.a)({[v]:function(e,t){return t.payload.persons}},[]),toponyms:Object(p.a)({[v]:function(e,t){return t.payload.toponyms}},[]),events:Object(p.a)({[v]:function(e,t){return Object(h.a)(t.payload.events.map((function(e){return Object(l.a)(Object(l.a)({},e),{},{startDate:new Date(e.startDate),endDate:new Date(e.endDate)})})),(function(e){return e.endDate-e.startDate}),"desc")},[g]:function(e,t){return e.map((function(e){return e.id===t.payload.id?t.payload:e}))},[C]:function(e,t){return e.filter((function(e){return e.id!==t.payload.id}))},[D]:function(e,t){return[].concat(Object(u.a)(e),[Object(l.a)(Object(l.a)({},t.payload),{},{id:Object(m.a)()})])}},[])}),S=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.d,k=Object(i.e)(w,S(Object(i.a)(s.a))),I=n(93),F=n(0),_=n(38),E=n(488),M=n(77),N=n(504),T=n(505),L=n(495),R=n(274),A=n(502),B=function(e){return e.events},z=function(e){return e.toponyms},H=function(e){return e.persons},K=function(e){return e.eventTypes},V=function(e){return e.isFetching},P=function(e){return e.error},Y=n(272),J=n.n(Y),U=n(8),X=864e5,q={align:"center",minHeight:"400px",maxHeight:"400px",type:"range",tooltip:{followMouse:!0,overflowMethod:"cap"},snap:null,orientation:{axis:"both"},zoomMin:432e6},G=function(){var e=Object(r.c)(B),t=Object(r.c)(K),n=Object(F.useMemo)((function(){return e.slice(0,10).map((function(e){return{start:e.startDate,end:e.endDate,content:e.name,duration:e.endDate-e.startDate,group:e.type,type:e.endDate-e.startDate<=X?"point":"range",title:(t=e,'\n  <div>\n    <h3 className="event-name">'.concat(t.name,'</h3>\n    <hr />\n    <div className="dates">\n      <div>\n        ').concat(t.startDate.toLocaleDateString()," - ").concat(t.endDate.toLocaleDateString(),"\n      </div>\n      <div>\n        <b>\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c: </b>\n        ").concat(Math.floor((t.endDate-t.startDate)/X)," \u0434\u043d.\n      </div>\n    </div>\n  </div>\n"))};var t}))}),[e]),a=Object(F.useMemo)((function(){return t.map((function(e){return{id:e.id,content:e.type}}))}),[t]);return Object(U.jsx)("div",{children:n&&n.length>0&&Object(U.jsx)(J.a,{options:q,items:n,groups:a})})},Q=function(){var e=Object(r.c)(V),t=Object(r.c)(P);return Object(U.jsxs)(E.a,{children:[Object(U.jsx)(L.a,{ghost:!1,title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"}),Object(U.jsxs)(E.a.Content,{children:[e&&Object(U.jsx)("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"},children:Object(U.jsx)(R.a,{size:"large"})}),t&&Object(U.jsx)(A.a,{message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",description:t,type:"error",showIcon:!0}),!e&&!t&&Object(U.jsx)(G,{})]})]})},W=n(287),Z="/view",$="/editor",ee=n(50),te=n(506),ne=function(e){var t=e.filename,n=void 0===t?"events.json":t,a=Object(r.c)(B),c=Object(r.c)(K),o=Object(r.c)(H),i=Object(r.c)(z),s=JSON.stringify({events:a,eventTypes:c,toponyms:i,persons:o});return Object(U.jsxs)(ee.a,{download:n,href:URL.createObjectURL(new Blob([s],{type:"application/json"})),children:[Object(U.jsx)(te.a,{}),"Export to json"]})},ae=n(500),ce=n(489),re=n(497),oe=n(491),ie=function(e){return e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"})},se=function(e){return e.type},ue=function(e){return e.map((function(e){return"".concat(e.surname," ").concat(e.name," ").concat(e.patron)})).join()},le=function(e){return e.map((function(e){return e.name})).join()},je=function(e,t){return e.startDate-t.startDate},de=function(e,t){return e.endDate-t.endDate},be=function(e){var t=e.onAdd,n=e.onSelect,a=e.deleteRow,c=Object(F.useState)(""),o=Object(I.a)(c,2),i=o[0],s=o[1],u=Object(r.c)(K),j=Object(r.c)(H),d=Object(r.c)(z),b=Object(r.c)(B),O=Object(F.useMemo)((function(){return b.map((function(e){return Object(l.a)(Object(l.a)({},e),{},{type:u.find((function(t){return t.id===e.type})),persons:e.persons?e.persons.map((function(e){return j.find((function(t){return t.id===e}))})):[],toponyms:e.toponyms?e.toponyms.map((function(e){return d.find((function(t){return t.id===e}))})):[]})})).filter((function(e){return e.name.toLowerCase().includes(i.toLowerCase())}))}),[b,u,j,d,i]),p=Object(F.useCallback)((function(e){return{onClick:n?function(){return n(e)}:void 0}}),[n]),f=Object(F.useCallback)(Object(ae.a)((function(e){return s(e)})),[]);return Object(U.jsxs)("div",{children:[Object(U.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"10px 20px"},children:[Object(U.jsx)(ee.a,{type:"primary",onClick:t,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),Object(U.jsx)(re.a.Search,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430",onSearch:f,style:{width:400}})]}),Object(U.jsxs)(oe.a,{dataSource:O,rowKey:function(e){return e.id},onRow:p,children:[Object(U.jsx)(oe.a.Column,{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",width:"35%"}),Object(U.jsx)(oe.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",dataIndex:"startDate",width:"10%",sorter:je,render:ie}),Object(U.jsx)(oe.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",dataIndex:"endDate",width:"10%",sorter:de,render:ie}),Object(U.jsx)(oe.a.Column,{title:"\u0422\u0438\u043f",dataIndex:"type",width:"10%",filters:u.map((function(e){return{value:e.id,text:e.type}})),onFilter:function(e,t){return t.type.id===e},render:se}),Object(U.jsx)(oe.a.Column,{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",dataIndex:"persons",width:"15%",render:ue}),Object(U.jsx)(oe.a.Column,{title:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",dataIndex:"toponyms",width:"15%",render:le}),Object(U.jsx)(oe.a.Column,{title:"",render:function(e,t){return Object(U.jsx)(ce.a,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onConfirm:function(e){e.stopPropagation(),a(t)},onCancel:function(e){e.stopPropagation()},okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442",children:Object(U.jsx)(ee.a,{type:"link",onClick:function(e){e.stopPropagation()},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})})}},"delete")]})]})},Oe=n(192),pe=n(499),fe=n(494),he=n(60),me=n.n(he),xe=n(109),ve=n(169),ye=n(493),ge=function(e){var t=e.dateFormat,n=void 0===t?"DD.MM.YYYY":t,a=Object(xe.a)(e,["dateFormat"]);return Object(U.jsx)(ye.a,Object(l.a)({format:n},a))},Ce=n(152),De=function(e){return e.id},we=function(e){return e.name},Se=[],ke=function(e){var t=e.options,n=void 0===t?Se:t,a=e.optionKeyFactory,c=void 0===a?De:a,r=e.optionValueFactory,o=void 0===r?De:r,i=e.optionNameFactory,s=void 0===i?we:i,u=Object(xe.a)(e,["options","optionKeyFactory","optionValueFactory","optionNameFactory"]);return Object(U.jsx)(Ce.a,Object(l.a)(Object(l.a)({},u),{},{children:n.map((function(e){return Object(U.jsx)(Ce.a.Option,{value:o(e),children:s(e)},c(e))}))}))},Ie=n(498),Fe=[],_e=function(e){var t=e.allOptions,n=e.value,a=void 0===n?Fe:n,c=e.onChange,r=e.placeholder,o=e.count,i=void 0===o?5:o,s=e.optionKeyFactory,l=void 0===s?De:s,j=e.optionValueFactory,d=void 0===j?De:j,b=e.optionNameFactory,O=void 0===b?we:b,p=Object(F.useState)([]),f=Object(I.a)(p,2),h=f[0],m=f[1],x=Object(F.useCallback)(Object(ae.a)((function(e){m(t.filter((function(t){return O(t).toLowerCase().includes(e.toLocaleLowerCase())})))}),300),[t]),v=Object(F.useCallback)((function(){m([])}),[]),y=Object(F.useCallback)((function(e){m([]),c(e)}),[c]),g=Object(F.useMemo)((function(){return a.map((function(e){return t.find((function(t){return d(t)===e}))}))}),[t,a,d]),C=Object(F.useMemo)((function(){return h.length?h.slice(0,i):Object(Ie.a)([].concat(Object(u.a)(t.slice(0,i)),Object(u.a)(g)))}),[t,i,h,g]),D=Object(F.useMemo)((function(){return h.length?h.length-i:t.length-C.length}),[t,i,h,C.length]);return Object(U.jsxs)(Ce.a,{placeholder:r,mode:"multiple",filterOption:!1,onSearch:x,onChange:y,onBlur:v,value:a,children:[C.map((function(e){return Object(U.jsx)(Ce.a.Option,{value:d(e),children:O(e)},l(e))})),D>0&&Object(U.jsxs)(Ce.a.Option,{value:"__hidedOptionsCount__",disabled:!0,children:["\u0415\u0449\u0435 ",D," \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"]},"__hidedOptionsCount__")]})},Ee=function(e){return function(t){var n=t.name,a=t.label,c=t.validate,r=t.allowNull,o=void 0===r||r,i=t.format,s=void 0===i?ve.a:i,u=t.parse,j=void 0===u?ve.a:u,d=Object(xe.a)(t,["name","label","validate","allowNull","format","parse"]);return Object(U.jsx)(Oe.a,{name:n,format:s,parse:j,allowNull:o,validate:c,children:function(t){var n=t.input,c=n.value,r=n.onChange,o=n.onBlur,i=n.onFocus,s=t.meta,u=s.invalid,j=s.touched,b=s.error;return Object(U.jsx)(fe.a.Item,{label:a,validateStatus:j&&u?"error":"success",help:j&&u?b:void 0,children:Object(U.jsx)(e,Object(l.a)({value:c,onChange:r,onBlur:o,onFocus:i},d))})}})}},Me=function(e){return function(t){var n=t.debounceTimeout,a=void 0===n?300:n,c=t.onChange,r=t.value,o=Object(xe.a)(t,["debounceTimeout","onChange","value"]),i=Object(F.useState)(r),s=Object(I.a)(i,2),u=s[0],j=s[1],d=Object(F.useCallback)(Object(ae.a)((function(e){c(e)}),a),[]),b=Object(F.useCallback)((function(e){var t=e.target.value;j(t),d(t)}),[d]);return Object(U.jsx)(e,Object(l.a)({value:u,onChange:b},o))}},Ne=(Ee(Me(re.a)),Ee(Me(re.a.TextArea))),Te=Ee(ge),Le=Ee(ke),Re=Ee(_e),Ae=n(490),Be=n(37),ze=function(e){return Object(Ae.a)(e)||""===e||Object(Be.a)(e)&&0===e.length?"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e":void 0},He=function(e,t){return function(n,a){return n.isBefore(a[e],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(t):void 0}},Ke=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,a){return t.reduce((function(t,c){return t||c(e,n,a)}),void 0)}},Ve=function(e){return e.type},Pe=function(e){return"".concat(e.surname," ").concat(e.name," ").concat(e.patron)},Ye={name:null,startDate:null,endDate:null,type:null,toponyms:[],persons:[]},Je=function(e){var t=e.onSubmit,n=e.onClose,a=e.title,c=Object(r.c)(K),o=Object(r.c)(z),i=Object(r.c)(H),s=Object(r.c)(B),u=Object(_.j)().id;if(s.length<1)return Object(U.jsx)(pe.a,{title:a,onClose:n,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(U.jsx)("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"},children:Object(U.jsx)(R.a,{size:"large"})})});var j=s.find((function(e){return e.id===Number(u)})),d=j?function(e){return Object(l.a)(Object(l.a)({},e),{},{startDate:me()(e.startDate),endDate:me()(e.endDate)})}(j):Ye;return Object(U.jsx)(pe.a,{title:a,onClose:n,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(U.jsx)(Oe.b,{initialValues:d,onSubmit:function(e){t(e)},children:function(e){var t,n,a=e.handleSubmit;return Object(U.jsxs)(fe.a,{layout:"vertical",onFinish:a,children:[Object(U.jsx)(fe.a.Item,{children:Object(U.jsx)(Ne,{name:"name",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",rows:4,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",validate:ze})}),Object(U.jsx)(fe.a.Item,{children:Object(U.jsx)(Te,{name:"startDate",label:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",validate:Ke(ze,(t="endDate",n="\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",function(e,a){return e.isAfter(a[t],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(n):void 0}))})}),Object(U.jsx)(fe.a.Item,{children:Object(U.jsx)(Te,{name:"endDate",label:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",validate:Ke(ze,He("startDate","\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430"))})}),Object(U.jsx)(fe.a.Item,{children:Object(U.jsx)(Le,{name:"type",label:"\u0422\u0438\u043f",options:c,optionNameFactory:Ve,validate:ze})}),Object(U.jsx)(fe.a.Item,{children:Object(U.jsx)(Re,{name:"toponyms",label:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",allOptions:o,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043f\u043e\u043d\u0438\u043c\u044b"})}),Object(U.jsx)(fe.a.Item,{children:Object(U.jsx)(Re,{name:"persons",label:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",allOptions:i,optionNameFactory:Pe,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043b\u0438\u0446"})}),Object(U.jsx)("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"},children:Object(U.jsx)(ee.a,{htmlType:"submit",type:"primary",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]})}})})},Ue="".concat($,"/add"),Xe="".concat($,"/edit/:id"),qe=function(){var e=Object(r.b)(),t=Object(_.h)(),n=Object(F.useCallback)((function(e){t.push(Object(_.f)(Xe,{id:e.id}))}),[t]),a=Object(F.useCallback)((function(){t.push($)}),[t]),c=Object(F.useCallback)((function(t){e(g(Object(l.a)(Object(l.a)({},t),{},{endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),a(),W.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e")}),[e,a]),o=Object(F.useCallback)((function(t){e(C(t))}),[e]),i=Object(F.useCallback)((function(t){e(D(Object(l.a)(Object(l.a)({},t),{},{id:Object(m.a)(),endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),a(),W.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e")}),[a,e]),s=Object(F.useCallback)((function(){t.push(Ue)}),[t]);return Object(U.jsxs)(E.a,{children:[Object(U.jsx)(L.a,{ghost:!1,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445",extra:Object(U.jsx)(ne,{})}),Object(U.jsxs)(E.a.Content,{children:[Object(U.jsx)(be,{onAdd:s,onSelect:n,deleteRow:o}),Object(U.jsx)(_.b,{path:Ue,render:function(){return Object(U.jsx)(Je,{onClose:a,onSubmit:i,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}}),Object(U.jsx)(_.b,{path:Xe,render:function(){return Object(U.jsx)(Je,{onClose:a,onSubmit:c,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}})]})]})},Ge=[Z,$],Qe=function(){var e=Object(F.useState)(!0),t=Object(I.a)(e,2),a=t[0],c=t[1],i=Object(r.b)(),s=Object(_.i)().pathname,u=Object(F.useMemo)((function(){return[Ge.find((function(e){return e===s}))]}),[s]);return Object(F.useEffect)((function(){i(function(){var e=Object(b.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(x()),e.prev=1,e.next=4,n.e(3).then(n.t.bind(null,507,3));case 4:a=e.sent,t(v(a)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t(y(e.t0));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}())}),[i]),Object(U.jsxs)(E.a,{style:{minHeight:"100vh"},hasSider:!0,children:[Object(U.jsx)(E.a.Sider,{theme:"dark",collapsible:!0,width:240,collapsed:a,onCollapse:c,style:{overflow:"auto",height:"100vh",position:"fixed",left:0},children:Object(U.jsxs)(M.a,{theme:"dark",mode:"inline",selectedKeys:u,children:[Object(U.jsx)(M.a.Item,{children:Object(U.jsxs)(o.b,{to:Z,children:[Object(U.jsx)(N.a,{}),Object(U.jsx)("span",{children:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"})]})},Z),Object(U.jsx)(M.a.Item,{children:Object(U.jsxs)(o.b,{to:$,children:[Object(U.jsx)(T.a,{}),Object(U.jsx)("span",{children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445"})]})},$)]})}),Object(U.jsx)(E.a,{style:{marginLeft:a?80:240,transition:"margin 0.2s"},children:Object(U.jsx)(E.a.Content,{children:Object(U.jsxs)(_.d,{children:[Object(U.jsx)(_.b,{path:Z,component:Q}),Object(U.jsx)(_.b,{path:$,component:qe}),Object(U.jsx)(_.a,{to:Z})]})})})]})};n(483);c.a.render(Object(U.jsx)(o.a,{children:Object(U.jsx)(r.a,{store:k,children:Object(U.jsx)(Qe,{})})}),document.getElementById("root"))}},[[484,1,2]]]);
//# sourceMappingURL=main.9719cda0.chunk.js.map