(this["webpackJsonpviz-react"]=this["webpackJsonpviz-react"]||[]).push([[0],{400:function(e,t,a){},401:function(e,t,a){"use strict";a.r(t);var n=a(44),c=a.n(n),s=a(42),o=a(110),l=a(126),i=a(232),r=a(417),j=a(411),d=a(415),b=a(407),O=a(403);const p=Object(r.a)("loadEventsRequest"),u=Object(r.a)("loadEventsSuccess"),h=Object(r.a)("loadEventsFailure"),m=Object(r.a)("editEvent"),x=Object(r.a)("deleteEvent"),y=Object(r.a)("addEvent");var v=Object(l.b)({isFetching:Object(j.a)({[p]:()=>!0,[Object(d.a)(u,h)]:()=>!1},!1),error:Object(j.a)({[p]:()=>null,[h]:(e,t)=>t},null),eventTypes:Object(j.a)({[u]:(e,t)=>t.payload.eventTypes},[]),persons:Object(j.a)({[u]:(e,t)=>t.payload.persons},[]),toponyms:Object(j.a)({[u]:(e,t)=>t.payload.toponyms},[]),events:Object(j.a)({[u]:(e,t)=>Object(b.a)(t.payload.events.map((e=>({...e,startDate:new Date(e.startDate),endDate:new Date(e.endDate)}))),(e=>e.endDate-e.startDate),"desc"),[m]:(e,t)=>e.map((e=>e.id===t.payload.id?t.payload:e)),[x]:(e,t)=>e.filter((e=>e.id!==t.payload.id)),[y]:(e,t)=>[...e,{...t.payload,id:Object(O.a)()}]},[])});const C=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||l.c;var D=Object(l.d)(v,C(Object(l.a)(i.a))),f=a(0),g=a(36),w=a(405),S=a(79),k=a(419),I=a(244),F=a(410);const _="/editor";var E=a(52),T=a(418);const L=e=>e.events,N=e=>e.toponyms,M=e=>e.persons,B=e=>e.eventTypes;var R=a(10);var A=({filename:e="events.json"})=>{const t=Object(s.c)(L),a=Object(s.c)(B),n=Object(s.c)(M),c=Object(s.c)(N),o=JSON.stringify({events:t,eventTypes:a,toponyms:c,persons:n});return Object(R.jsxs)(E.a,{download:e,href:URL.createObjectURL(new Blob([o],{type:"application/json"})),children:[Object(R.jsx)(T.a,{}),"Export to json"]})},K=a(414),P=a(416),V=a(242),Y=a(406);const z=e=>e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"}),J=e=>e.type,U=e=>e.map((e=>"".concat(e.surname," ").concat(e.name," ").concat(e.patron))).join(),H=e=>e.map((e=>e.name)).join(),X=(e,t)=>e.startDate-t.startDate,q=(e,t)=>e.endDate-t.endDate;var G=({onAdd:e,onSelect:t,deleteRow:a})=>{const[n,c]=Object(f.useState)(""),o=Object(s.c)(B),l=Object(s.c)(M),i=Object(s.c)(N),r=Object(s.c)(L),j=Object(f.useMemo)((()=>r.map((e=>({...e,type:o.find((t=>t.id===e.type)),persons:e.persons?e.persons.map((e=>l.find((t=>t.id===e)))):[],toponyms:e.toponyms?e.toponyms.map((e=>i.find((t=>t.id===e)))):[]}))).filter((e=>e.name.toLowerCase().includes(n.toLowerCase())))),[r,o,l,i,n]),d=Object(f.useCallback)((e=>({onClick:t?()=>t(e):void 0})),[t]),b=Object(f.useCallback)(Object(K.a)((e=>c(e))),[]);return Object(R.jsxs)("div",{children:[Object(R.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"10px 20px"},children:[Object(R.jsx)(E.a,{type:"primary",onClick:e,"data-id":"add-button",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),Object(R.jsx)(V.a.Search,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430",onSearch:b,style:{width:400},"data-id":"search"})]}),Object(R.jsxs)(Y.a,{dataSource:j,rowKey:e=>e.id,onRow:d,children:[Object(R.jsx)(Y.a.Column,{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",width:"35%"}),Object(R.jsx)(Y.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",dataIndex:"startDate",width:"10%",sorter:X,render:z}),Object(R.jsx)(Y.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",dataIndex:"endDate",width:"10%",sorter:q,render:z}),Object(R.jsx)(Y.a.Column,{title:"\u0422\u0438\u043f",dataIndex:"type",width:"10%",filters:o.map((e=>({value:e.id,text:e.type}))),onFilter:(e,t)=>t.type.id===e,render:J}),Object(R.jsx)(Y.a.Column,{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",dataIndex:"persons",width:"15%",render:U}),Object(R.jsx)(Y.a.Column,{title:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",dataIndex:"toponyms",width:"15%",render:H}),Object(R.jsx)(Y.a.Column,{title:"",render:(e,t)=>Object(R.jsx)(P.a,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onConfirm:e=>{e.stopPropagation(),a(t)},onCancel:e=>{e.stopPropagation()},okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442",children:Object(R.jsx)(E.a,{type:"link",onClick:e=>{e.stopPropagation()},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})})},"delete")]})]})},Q=a(186),W=a(413),Z=a(237),$=a(409),ee=a(71),te=a.n(ee),ae=a(162),ne=a(408);var ce=({dateFormat:e="DD.MM.YYYY",...t})=>Object(R.jsx)(ne.a,{format:e,...t}),se=a(145);const oe=e=>e.id,le=e=>e.name,ie=[];var re=({options:e=ie,optionKeyFactory:t=oe,optionValueFactory:a=oe,optionNameFactory:n=le,...c})=>Object(R.jsx)(se.a,{...c,children:e.map((e=>Object(R.jsx)(se.a.Option,{value:a(e),children:n(e)},t(e))))}),je=a(412);const de=[];var be=({allOptions:e,value:t=de,onChange:a,placeholder:n,count:c=5,optionKeyFactory:s=oe,optionValueFactory:o=oe,optionNameFactory:l=le,...i})=>{const[r,j]=Object(f.useState)([]),d=Object(f.useCallback)(Object(K.a)((t=>{j(e.filter((e=>l(e).toLowerCase().includes(t.toLocaleLowerCase()))))}),300),[e]),b=Object(f.useCallback)((()=>{j([])}),[]),O=Object(f.useCallback)((e=>{j([]),a(e)}),[a]),p=Object(f.useMemo)((()=>t.map((t=>e.find((e=>o(e)===t))))),[e,t,o]),u=Object(f.useMemo)((()=>r.length?r.slice(0,c):Object(je.a)([...e.slice(0,c),...p])),[e,c,r,p]),h=Object(f.useMemo)((()=>r.length?r.length-c:e.length-u.length),[e,c,r,u.length]);return Object(R.jsxs)(se.a,{...i,placeholder:n,mode:"multiple",filterOption:!1,onSearch:d,onChange:O,onBlur:b,value:t,children:[u.map((e=>Object(R.jsx)(se.a.Option,{value:o(e),children:l(e)},s(e)))),h>0&&Object(R.jsxs)(se.a.Option,{value:"__hidedOptionsCount__",disabled:!0,children:["\u0415\u0449\u0435 ",h," \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"]},"__hidedOptionsCount__")]})};const Oe=e=>({name:t,label:a,validate:n,allowNull:c=!0,format:s=ae.a,parse:o=ae.a,...l})=>Object(R.jsx)(Q.a,{name:t,format:s,parse:o,allowNull:c,validate:n,children:({input:{value:n,onChange:c,onBlur:s,onFocus:o},meta:{invalid:i,touched:r,error:j}})=>Object(R.jsx)($.a.Item,{label:a,validateStatus:r&&i?"error":"success",help:r&&i?j:void 0,children:Object(R.jsx)(e,{name:t,value:n,onChange:c,onBlur:s,onFocus:o,...l})})}),pe=e=>function({debounceTimeout:t=300,onChange:a,value:n,...c}){const[s,o]=Object(f.useState)(n),l=Object(f.useCallback)(Object(K.a)((e=>{a(e)}),t),[]),i=Object(f.useCallback)((({target:{value:e}})=>{o(e),l(e)}),[l]);return Object(R.jsx)(e,{value:s,onChange:i,...c})},ue=(Oe(pe(V.a)),Oe(pe(V.a.TextArea))),he=Oe(ce),me=Oe(re),xe=Oe(be);var ye=a(404),ve=a(35);const Ce=e=>Object(ye.a)(e)||""===e||Object(ve.a)(e)&&0===e.length?"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e":void 0,De=(e,t)=>(a,n)=>a.isBefore(n[e],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(t):void 0,fe=(...e)=>(t,a,n)=>e.reduce(((e,c)=>e||c(t,a,n)),void 0),ge=e=>e.type,we=e=>[e.surname,e.name,e.patron].filter(Boolean).join(" "),Se={name:null,startDate:null,endDate:null,type:null,toponyms:[],persons:[]};var ke=({onSubmit:e,onClose:t,title:a})=>{const n=Object(s.c)(B),c=Object(s.c)(N),o=Object(s.c)(M),l=Object(s.c)(L),{id:i}=Object(g.j)();if(l.length<1)return Object(R.jsx)(W.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(R.jsx)("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"},children:Object(R.jsx)(Z.a,{size:"large"})})});const r=l.find((e=>e.id===Number(i))),j=r?(e=>({...e,startDate:te()(e.startDate),endDate:te()(e.endDate)}))(r):Se;return Object(R.jsx)(W.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0,children:Object(R.jsx)(Q.b,{initialValues:j,onSubmit:t=>{e(t)},children:({handleSubmit:e})=>{return Object(R.jsxs)($.a,{layout:"vertical",onFinish:e,children:[Object(R.jsx)($.a.Item,{children:Object(R.jsx)(ue,{name:"name",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",rows:4,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",validate:Ce})}),Object(R.jsx)($.a.Item,{children:Object(R.jsx)(he,{name:"startDate",label:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",validate:fe(Ce,(t="endDate",a="\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",(e,n)=>e.isAfter(n[t],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(a):void 0))})}),Object(R.jsx)($.a.Item,{children:Object(R.jsx)(he,{name:"endDate",label:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",validate:fe(Ce,De("startDate","\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430"))})}),Object(R.jsx)($.a.Item,{children:Object(R.jsx)(me,{name:"type",label:"\u0422\u0438\u043f",options:n,optionNameFactory:ge,validate:Ce})}),Object(R.jsx)($.a.Item,{children:Object(R.jsx)(xe,{name:"toponyms",label:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",allOptions:c,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043f\u043e\u043d\u0438\u043c\u044b"})}),Object(R.jsx)($.a.Item,{children:Object(R.jsx)(xe,{name:"persons",label:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",allOptions:o,optionNameFactory:we,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043b\u0438\u0446"})}),Object(R.jsx)("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"},children:Object(R.jsx)(E.a,{htmlType:"submit",type:"primary","data-id":"save-button",children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]});var t,a}})})};const Ie="".concat(_,"/add"),Fe="".concat(_,"/edit/:id");var _e=()=>{const e=Object(s.b)(),t=Object(g.h)(),a=Object(f.useCallback)((e=>{t.push(Object(g.f)(Fe,{id:e.id}))}),[t]),n=Object(f.useCallback)((()=>{t.push(_)}),[t]),c=Object(f.useCallback)((t=>{e(m({...t,endDate:t.endDate.toDate(),startDate:t.startDate.toDate()})),n(),I.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e")}),[e,n]),o=Object(f.useCallback)((t=>{e(x(t))}),[e]),l=Object(f.useCallback)((t=>{e(y({...t,id:Object(O.a)(),endDate:t.endDate.toDate(),startDate:t.startDate.toDate()})),n(),I.b.success("\u0421\u043e\u0431\u044b\u0442\u0438\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e")}),[n,e]),i=Object(f.useCallback)((()=>{t.push(Ie)}),[t]);return Object(R.jsxs)(w.a,{children:[Object(R.jsx)(F.a,{ghost:!1,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445",extra:Object(R.jsx)(A,{})}),Object(R.jsxs)(w.a.Content,{children:[Object(R.jsx)(G,{onAdd:i,onSelect:a,deleteRow:o}),Object(R.jsx)(g.b,{path:Ie,render:()=>Object(R.jsx)(ke,{onClose:n,onSubmit:l,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}),Object(R.jsx)(g.b,{path:Fe,render:()=>Object(R.jsx)(ke,{onClose:n,onSubmit:c,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})})]})]})};const Ee=[_];var Te=()=>{const[e,t]=Object(f.useState)(!0),n=Object(s.b)(),{pathname:c}=Object(g.i)(),l=Object(f.useMemo)((()=>[Ee.find((e=>e===c))]),[c]);return Object(f.useEffect)((()=>{n((async e=>{e(p());try{const t=await a.e(3).then(a.t.bind(null,420,3));e(u(t))}catch(t){e(h(t))}}))}),[n]),Object(R.jsxs)(w.a,{style:{minHeight:"100vh"},hasSider:!0,children:[Object(R.jsx)(w.a.Sider,{theme:"dark",collapsible:!0,width:240,collapsed:e,onCollapse:t,style:{overflow:"auto",height:"100vh",position:"fixed",left:0},children:Object(R.jsx)(S.a,{theme:"dark",mode:"inline",selectedKeys:l,children:Object(R.jsx)(S.a.Item,{children:Object(R.jsxs)(o.b,{to:_,children:[Object(R.jsx)(k.a,{}),Object(R.jsx)("span",{children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445"})]})},_)})}),Object(R.jsx)(w.a,{style:{marginLeft:e?80:240,transition:"margin 0.2s"},children:Object(R.jsx)(w.a.Content,{children:Object(R.jsxs)(g.d,{children:[Object(R.jsx)(g.b,{path:_,component:_e}),Object(R.jsx)(g.a,{to:_})]})})})]})};a(400);c.a.render(Object(R.jsx)(o.a,{children:Object(R.jsx)(s.a,{store:D,children:Object(R.jsx)(Te,{})})}),document.getElementById("root"))}},[[401,1,2]]]);
//# sourceMappingURL=main.a9d32268.chunk.js.map