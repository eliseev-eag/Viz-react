(this["webpackJsonpviz-react"]=this["webpackJsonpviz-react"]||[]).push([[0],{282:function(e,t,a){e.exports=a(517)},516:function(e,t,a){},517:function(e,t,a){"use strict";a.r(t);var n=a(0),l=a.n(n),o=a(7),c=a.n(o),r=a(11),i=a(81),s=a(70),d=a(245),m=a(43),p=a(192),u=a.n(p),b=a(246),O=a(537),v=a(528),j=a(533),E=a(524),y=a(520);const h=Object(O.a)("loadEventsRequest"),g=Object(O.a)("loadEventsSuccess"),C=Object(O.a)("loadEventsFailure"),D=()=>function(){var e=Object(b.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(h()),e.prev=1,e.next=4,a.e(3).then(a.t.bind(null,541,3));case 4:n=e.sent,t(g(n)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t(C(e.t0));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),f=Object(O.a)("editEvent"),w=Object(O.a)("deleteEvent"),k=Object(O.a)("addEvent");var x=Object(s.c)({isFetching:Object(v.a)({[h]:()=>!0,[Object(j.a)(g,C)]:()=>!1},!1),error:Object(v.a)({[h]:()=>null,[C]:(e,t)=>t},null),eventTypes:Object(v.a)({[g]:(e,t)=>t.payload.eventTypes},[]),persons:Object(v.a)({[g]:(e,t)=>t.payload.persons},[]),toponyms:Object(v.a)({[g]:(e,t)=>t.payload.toponyms},[]),events:Object(v.a)({[g]:(e,t)=>Object(E.a)(t.payload.events.map(e=>Object(m.a)({},e,{startDate:new Date(e.startDate),endDate:new Date(e.endDate)})),e=>e.endDate-e.startDate,"desc"),[f]:(e,t)=>e.map(e=>e.id===t.payload.id?t.payload:e),[w]:(e,t)=>e.filter(e=>e.id!==t.payload.id),[k]:(e,t)=>[...e,Object(m.a)({},t.payload,{id:Object(y.a)()})]},[])});const S=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||s.d;var F=Object(s.e)(x,S(Object(s.a)(d.a))),I=a(69),_=a(74),M=a(521),N=a(44),T=a(539),L=a(536),R=a(531),z=a(255),A=a(534);const H=e=>e.events,K=e=>e.toponyms,V=e=>e.persons,B=e=>e.eventTypes,P=e=>e.isFetching,Y=e=>e.error;var J=a(248),U=a.n(J);const X={align:"center",minHeight:"400px",maxHeight:"400px",type:"range",tooltip:{followMouse:!0,overflowMethod:"cap"},snap:null,orientation:{axis:"both"},zoomMin:432e6};var q=()=>{const e=Object(r.c)(H),t=Object(r.c)(B),a=Object(n.useMemo)(()=>e.slice(0,10).map(e=>{return{start:e.startDate,end:e.endDate,content:e.name,duration:e.endDate-e.startDate,group:e.type,type:e.endDate-e.startDate<=864e5?"point":"range",title:(t=e,'\n  <div>\n    <h3 className="event-name">'.concat(t.name,'</h3>\n    <hr />\n    <div className="dates">\n      <div>\n        ').concat(t.startDate.toLocaleDateString()," - ").concat(t.endDate.toLocaleDateString(),"\n      </div>\n      <div>\n        <b>\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c: </b>\n        ").concat(Math.floor((t.endDate-t.startDate)/864e5)," \u0434\u043d.\n      </div>\n    </div>\n  </div>\n"))};var t}),[e]),o=Object(n.useMemo)(()=>t.map(e=>({id:e.id,content:e.type})),[t]);return l.a.createElement("div",null,a&&a.length>0&&l.a.createElement(U.a,{options:X,items:a,groups:o}))};var G=()=>{const e=Object(r.c)(P),t=Object(r.c)(Y);return l.a.createElement(M.a,null,l.a.createElement(R.a,{ghost:!1,title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"}),l.a.createElement(M.a.Content,null,e&&l.a.createElement("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"}},l.a.createElement(z.a,{size:"large"})),t&&l.a.createElement(A.a,{message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",description:t,type:"error",showIcon:!0}),!e&&!t&&l.a.createElement(q,null)))};var Q=a(19),W=a(538);var Z=({filename:e="events.json"})=>{const t=Object(r.c)(H),a=Object(r.c)(B),n=Object(r.c)(V),o=Object(r.c)(K),c=JSON.stringify({events:t,eventTypes:a,toponyms:o,persons:n});return l.a.createElement(Q.a,{download:e,href:URL.createObjectURL(new Blob([c],{type:"application/json"}))},l.a.createElement(W.a,null),"Export to json")},$=a(535),ee=a(540),te=a(530),ae=a(525);const ne=e=>e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"}),le=e=>e.type,oe=e=>e.map(e=>"".concat(e.surname," ").concat(e.name," ").concat(e.patron)).join(),ce=e=>e.map(e=>e.name).join(),re=(e,t)=>e.startDate-t.startDate,ie=(e,t)=>e.endDate-t.endDate;var se=({onAdd:e,onSelect:t,deleteRow:a})=>{const o=Object(n.useState)(""),c=Object(I.a)(o,2),i=c[0],s=c[1],d=Object(r.c)(B),p=Object(r.c)(V),u=Object(r.c)(K),b=Object(r.c)(H),O=Object(n.useMemo)(()=>b.map(e=>Object(m.a)({},e,{type:d.find(t=>t.id===e.type),persons:e.persons?e.persons.map(e=>p.find(t=>t.id===e)):[],toponyms:e.toponyms?e.toponyms.map(e=>u.find(t=>t.id===e)):[]})).filter(e=>e.name.toLowerCase().includes(i.toLowerCase())),[b,d,p,u,i]),v=Object(n.useCallback)(e=>({onClick:t?()=>t(e):void 0}),[t]),j=Object(n.useCallback)(Object($.a)(e=>s(e)),[]);return l.a.createElement("div",null,l.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"10px 20px"}},l.a.createElement(Q.a,{type:"primary",onClick:e},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"),l.a.createElement(te.a.Search,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430",onSearch:j,style:{width:400}})),l.a.createElement(ae.a,{dataSource:O,rowKey:e=>e.id,onRow:v},l.a.createElement(ae.a.Column,{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",width:"35%"}),l.a.createElement(ae.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",dataIndex:"startDate",width:"10%",sorter:re,render:ne}),l.a.createElement(ae.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",dataIndex:"endDate",width:"10%",sorter:ie,render:ne}),l.a.createElement(ae.a.Column,{title:"\u0422\u0438\u043f",dataIndex:"type",width:"10%",filters:d.map(e=>({value:e.id,text:e.type})),onFilter:(e,t)=>t.type.id===e,render:le}),l.a.createElement(ae.a.Column,{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",dataIndex:"persons",width:"15%",render:oe}),l.a.createElement(ae.a.Column,{title:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",dataIndex:"toponyms",width:"15%",render:ce}),l.a.createElement(ae.a.Column,{title:"",key:"delete",render:(e,t)=>l.a.createElement(ee.a,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onConfirm:e=>{e.stopPropagation(),a(t)},onCancel:e=>{e.stopPropagation()},okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442"},l.a.createElement(Q.a,{type:"link",onClick:e=>{e.stopPropagation()}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))})))},de=a(152),me=a(532),pe=a(527),ue=a(523),be=a(38),Oe=a.n(be),ve=a(87),je=a(141),Ee=a(526);var ye=e=>{let t=e.dateFormat,a=void 0===t?"DD.MM.YYYY":t,n=Object(ve.a)(e,["dateFormat"]);return l.a.createElement(Ee.a,Object.assign({format:a},n))},he=a(125);const ge=e=>e.id,Ce=e=>e.name,De=[];var fe=e=>{let t=e.options,a=void 0===t?De:t,n=e.optionKeyFactory,o=void 0===n?ge:n,c=e.optionValueFactory,r=void 0===c?ge:c,i=e.optionNameFactory,s=void 0===i?Ce:i,d=Object(ve.a)(e,["options","optionKeyFactory","optionValueFactory","optionNameFactory"]);return l.a.createElement(he.a,d,a.map(e=>l.a.createElement(he.a.Option,{key:o(e),value:r(e)},s(e))))},we=a(529);const ke=[];var xe=({allOptions:e,value:t=ke,onChange:a,placeholder:o,count:c=5,optionKeyFactory:r=ge,optionValueFactory:i=ge,optionNameFactory:s=Ce})=>{const d=Object(n.useState)([]),m=Object(I.a)(d,2),p=m[0],u=m[1],b=Object(n.useCallback)(Object($.a)(t=>{u(e.filter(e=>s(e).toLowerCase().includes(t.toLocaleLowerCase())))},300),[e]),O=Object(n.useCallback)(()=>{u([])},[]),v=Object(n.useCallback)(e=>{u([]),a(e)},[a]),j=Object(n.useMemo)(()=>t.map(t=>e.find(e=>i(e)===t)),[e,t,i]),E=Object(n.useMemo)(()=>p.length?p.slice(0,c):Object(we.a)([...e.slice(0,c),...j]),[e,c,p,j]),y=Object(n.useMemo)(()=>p.length?p.length-c:e.length-E.length,[e,c,p,E.length]);return l.a.createElement(he.a,{placeholder:o,mode:"multiple",filterOption:!1,onSearch:b,onChange:v,onBlur:O,value:t},E.map(e=>l.a.createElement(he.a.Option,{key:r(e),value:i(e)},s(e))),y>0&&l.a.createElement(he.a.Option,{key:"__hidedOptionsCount__",value:"__hidedOptionsCount__",disabled:!0},"\u0415\u0449\u0435 ",y," \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"))};const Se=e=>t=>{let a=t.name,n=t.label,o=t.validate,c=t.allowNull,r=void 0===c||c,i=t.format,s=void 0===i?je.a:i,d=t.parse,m=void 0===d?je.a:d,p=Object(ve.a)(t,["name","label","validate","allowNull","format","parse"]);return l.a.createElement(de.a,{name:a,format:s,parse:m,allowNull:r,validate:o},({input:{value:t,onChange:a},meta:{invalid:o,touched:c,error:r}})=>l.a.createElement(pe.a.Item,{label:n,validateStatus:c&&o?"error":"success",help:r},l.a.createElement(e,Object.assign({value:t,onChange:a},p))))},Fe=e=>function(t){let a=t.debounceTimeout,o=void 0===a?300:a,c=t.onChange,r=t.value,i=Object(ve.a)(t,["debounceTimeout","onChange","value"]);const s=Object(n.useState)(r),d=Object(I.a)(s,2),m=d[0],p=d[1],u=Object(n.useCallback)(Object($.a)(e=>{c(e)},o),[]),b=Object(n.useCallback)(({target:{value:e}})=>{p(e),u(e)},[u]);return l.a.createElement(e,Object.assign({value:m,onChange:b},i))},Ie=(Se(Fe(te.a)),Se(Fe(te.a.TextArea))),_e=Se(ye),Me=Se(fe),Ne=Se(xe);var Te=a(522),Le=a(15);const Re=e=>Object(Te.a)(e)||""===e||Object(Le.a)(e)&&0===e.length?"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e":void 0,ze=(e,t)=>(a,n)=>a.isBefore(n[e],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(t):void 0,Ae=(...e)=>(t,a,n)=>e.reduce((e,l)=>e||l(t,a,n),void 0),He=e=>e.type,Ke=e=>"".concat(e.surname," ").concat(e.name," ").concat(e.patron),Ve={name:null,startDate:null,endDate:null,type:null,toponyms:[],persons:[]};var Be=({onSubmit:e,onClose:t,title:a})=>{const n=Object(r.c)(B),o=Object(r.c)(K),c=Object(r.c)(V),i=Object(r.c)(H),s=Object(_.j)().id;if(i.length<1)return l.a.createElement(me.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0},l.a.createElement("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"}},l.a.createElement(z.a,{size:"large"})));const d=i.find(e=>e.id===Number(s)),p=d?(e=>Object(m.a)({},e,{startDate:Oe()(e.startDate),endDate:Oe()(e.endDate)}))(d):Ve;return l.a.createElement(me.a,{title:a,onClose:t,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0},l.a.createElement(de.b,{initialValues:p,onSubmit:t=>{e(t)}},({handleSubmit:e})=>{return l.a.createElement(pe.a,{layout:"vertical",onSubmit:e},l.a.createElement(ue.a,null,l.a.createElement(Ie,{name:"name",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",rows:4,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",validate:Re})),l.a.createElement(ue.a,null,l.a.createElement(_e,{name:"startDate",label:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",validate:Ae(Re,(t="endDate",a="\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",(e,n)=>e.isAfter(n[t],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(a):void 0))})),l.a.createElement(ue.a,null,l.a.createElement(_e,{name:"endDate",label:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",validate:Ae(Re,ze("startDate","\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430"))})),l.a.createElement(ue.a,null,l.a.createElement(Me,{name:"type",label:"\u0422\u0438\u043f",options:n,optionNameFactory:He,validate:Re})),l.a.createElement(ue.a,null,l.a.createElement(Ne,{name:"toponyms",label:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",allOptions:o,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043f\u043e\u043d\u0438\u043c\u044b"})),l.a.createElement(ue.a,null,l.a.createElement(Ne,{name:"persons",label:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",allOptions:c,optionNameFactory:Ke,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043b\u0438\u0446"})),l.a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},l.a.createElement(Q.a,{htmlType:"submit",type:"primary"},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")));var t,a}))};const Pe="".concat("/editor","/add"),Ye="".concat("/editor","/edit/:id");var Je=()=>{const e=Object(r.b)(),t=Object(_.h)(),a=Object(n.useCallback)(e=>{t.push(Object(_.f)(Ye,{id:e.id}))},[t]),o=Object(n.useCallback)(()=>{t.push("/editor")},[t]),c=Object(n.useCallback)(t=>{e(f(Object(m.a)({},t,{endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),o()},[e,o]),i=Object(n.useCallback)(t=>{e(w(t))},[e]),s=Object(n.useCallback)(t=>{e(k(Object(m.a)({},t,{id:Object(y.a)(),endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),o()},[o,e]),d=Object(n.useCallback)(()=>{t.push(Pe)},[t]);return l.a.createElement(M.a,null,l.a.createElement(R.a,{ghost:!1,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445",extra:l.a.createElement(Z,null)}),l.a.createElement(M.a.Content,null,l.a.createElement(se,{onAdd:d,onSelect:a,deleteRow:i}),l.a.createElement(_.b,{path:Pe,render:()=>l.a.createElement(Be,{onClose:o,onSubmit:s,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}),l.a.createElement(_.b,{path:Ye,render:()=>l.a.createElement(Be,{onClose:o,onSubmit:c,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})})))};const Ue=["/view","/editor"];var Xe=()=>{const e=Object(n.useState)(!0),t=Object(I.a)(e,2),a=t[0],o=t[1],c=Object(r.b)(),s=Object(_.i)().pathname,d=Object(n.useMemo)(()=>[Ue.find(e=>e===s)],[s]);return Object(n.useEffect)(()=>{c(D())},[c]),l.a.createElement(M.a,{style:{minHeight:"100vh"},hasSider:!0},l.a.createElement(M.a.Sider,{theme:"dark",collapsible:!0,width:240,collapsed:a,onCollapse:o,style:{overflow:"auto",height:"100vh",position:"fixed",left:0}},l.a.createElement(N.a,{theme:"dark",mode:"inline",selectedKeys:d},l.a.createElement(N.a.Item,{key:"/view"},l.a.createElement(i.b,{to:"/view"},l.a.createElement(T.a,null),l.a.createElement("span",null,"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"))),l.a.createElement(N.a.Item,{key:"/editor"},l.a.createElement(i.b,{to:"/editor"},l.a.createElement(L.a,null),l.a.createElement("span",null,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445"))))),l.a.createElement(M.a,{style:{marginLeft:a?80:240,transition:"margin 0.2s"}},l.a.createElement(M.a.Content,null,l.a.createElement(_.d,null,l.a.createElement(_.b,{path:"/view",component:G}),l.a.createElement(_.b,{path:"/editor",component:Je}),l.a.createElement(_.a,{to:"/view"})))))};a(516);c.a.render(l.a.createElement(i.a,null,l.a.createElement(r.a,{store:F},l.a.createElement(Xe,null))),document.getElementById("root"))}},[[282,1,2]]]);
//# sourceMappingURL=main.05882148.chunk.js.map