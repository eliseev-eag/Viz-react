(this["webpackJsonpviz-react"]=this["webpackJsonpviz-react"]||[]).push([[0],{285:function(e,t,n){e.exports=n(517)},516:function(e,t,n){},517:function(e,t,n){"use strict";n.r(t);var a,r,c,o=n(0),l=n.n(o),i=n(9),u=n.n(i),s=n(21),d=n(81),m=n(68),p=n(266),b=n(122),f=n(54),O=n(34),j=n(205),v=n.n(j),E=n(537),y=n(529),h=n(535),g=n(526),D=n(520),C=Object(E.a)("loadEventsRequest"),w=Object(E.a)("loadEventsSuccess"),x=Object(E.a)("loadEventsFailure"),k=Object(E.a)("editEvent"),S=Object(E.a)("deleteEvent"),F=Object(E.a)("addEvent"),I=Object(m.c)({isFetching:Object(y.a)((a={},Object(O.a)(a,C,(function(){return!0})),Object(O.a)(a,Object(h.a)(w,x),(function(){return!1})),a),!1),error:Object(y.a)((r={},Object(O.a)(r,C,(function(){return null})),Object(O.a)(r,x,(function(e,t){return t})),r),null),eventTypes:Object(y.a)(Object(O.a)({},w,(function(e,t){return t.payload.eventTypes})),[]),persons:Object(y.a)(Object(O.a)({},w,(function(e,t){return t.payload.persons})),[]),toponyms:Object(y.a)(Object(O.a)({},w,(function(e,t){return t.payload.toponyms})),[]),events:Object(y.a)((c={},Object(O.a)(c,w,(function(e,t){return Object(g.a)(t.payload.events.map((function(e){return Object(f.a)({},e,{startDate:new Date(e.startDate),endDate:new Date(e.endDate)})})),(function(e){return e.endDate-e.startDate}),"desc")})),Object(O.a)(c,k,(function(e,t){return e.map((function(e){return e.id===t.payload.id?t.payload:e}))})),Object(O.a)(c,S,(function(e,t){return e.filter((function(e){return e.id!==t.payload.id}))})),Object(O.a)(c,F,(function(e,t){return[].concat(Object(b.a)(e),[Object(f.a)({},t.payload,{id:Object(D.a)()})])})),c),[])}),_=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||m.d,M=Object(m.e)(I,_(Object(m.a)(p.a))),N=n(67),T=n(71),L=n(521),R=n(103),A=n(8),z=n(533),H=n(271),K=n(522),V=function(e){return e.events},B=function(e){return e.toponyms},P=function(e){return e.persons},Y=function(e){return e.eventTypes},J=function(e){return e.isFetching},U=function(e){return e.error},X=n(268),q=n.n(X),G={align:"center",minHeight:"400px",maxHeight:"400px",type:"range",tooltip:{followMouse:!0,overflowMethod:"cap"},snap:null,orientation:{axis:"both"},zoomMin:432e6},Q=function(){var e=Object(s.c)(V),t=Object(s.c)(Y),n=Object(o.useMemo)((function(){return e.slice(0,10).map((function(e){return{start:e.startDate,end:e.endDate,content:e.name,duration:e.endDate-e.startDate,group:e.type,type:e.endDate-e.startDate<=864e5?"point":"range",title:(t=e,'\n  <div>\n    <h3 className="event-name">'.concat(t.name,'</h3>\n    <hr />\n    <div className="dates">\n      <div>\n        ').concat(t.startDate.toLocaleDateString()," - ").concat(t.endDate.toLocaleDateString(),"\n      </div>\n      <div>\n        <b>\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c: </b>\n        ").concat(Math.floor((t.endDate-t.startDate)/864e5)," \u0434\u043d.\n      </div>\n    </div>\n  </div>\n"))};var t}))}),[e]),a=Object(o.useMemo)((function(){return t.map((function(e){return{id:e.id,content:e.type}}))}),[t]);return l.a.createElement("div",null,n&&n.length>0&&l.a.createElement(q.a,{options:G,items:n,groups:a}))},W=function(){var e=Object(s.c)(J),t=Object(s.c)(U);return l.a.createElement(L.a,null,l.a.createElement(z.a,{ghost:!1,title:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"}),l.a.createElement(L.a.Content,null,e&&l.a.createElement("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"}},l.a.createElement(H.a,{size:"large"})),t&&l.a.createElement(K.a,{message:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430",description:t,type:"error",showIcon:!0}),!e&&!t&&l.a.createElement(Q,null)))},Z=n(55),$=function(e){var t=e.filename,n=void 0===t?"events.json":t,a=Object(s.c)(V),r=Object(s.c)(Y),c=Object(s.c)(P),o=Object(s.c)(B),i=JSON.stringify({events:a,eventTypes:r,toponyms:o,persons:c});return l.a.createElement(Z.a,{download:n,href:URL.createObjectURL(new Blob([i],{type:"application/json"}))},l.a.createElement(A.a,{type:"download"}),"Export to json")},ee=n(536),te=n(523),ne=n(532),ae=n(528),re=function(e){return e.toLocaleString("ru",{year:"numeric",month:"numeric",day:"numeric"})},ce=function(e){return e.type},oe=function(e){return e.map((function(e){return"".concat(e.surname," ").concat(e.name," ").concat(e.patron)})).join()},le=function(e){return e.map((function(e){return e.name})).join()},ie=function(e,t){return e.startDate-t.startDate},ue=function(e,t){return e.endDate-t.endDate},se=function(e){var t=e.onAdd,n=e.onSelect,a=e.deleteRow,r=Object(o.useState)(""),c=Object(N.a)(r,2),i=c[0],u=c[1],d=Object(s.c)(Y),m=Object(s.c)(P),p=Object(s.c)(B),b=Object(s.c)(V),O=Object(o.useMemo)((function(){return b.map((function(e){return Object(f.a)({},e,{type:d.find((function(t){return t.id===e.type})),persons:e.persons?e.persons.map((function(e){return m.find((function(t){return t.id===e}))})):[],toponyms:e.toponyms?e.toponyms.map((function(e){return p.find((function(t){return t.id===e}))})):[]})})).filter((function(e){return e.name.toLowerCase().includes(i.toLowerCase())}))}),[b,d,m,p,i]),j=Object(o.useCallback)((function(e){return{onClick:n?function(){return n(e)}:void 0}}),[n]),v=Object(o.useCallback)(Object(ee.a)((function(e){return u(e)})),[]);return l.a.createElement("div",null,l.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"10px 20px"}},l.a.createElement(Z.a,{type:"primary",onClick:t},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"),l.a.createElement(ne.a.Search,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430",onSearch:v,style:{width:400}})),l.a.createElement(ae.a,{dataSource:O,rowKey:function(e){return e.id},onRow:j},l.a.createElement(ae.a.Column,{title:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",dataIndex:"name",width:"35%"}),l.a.createElement(ae.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",dataIndex:"startDate",width:"10%",sorter:ie,render:re}),l.a.createElement(ae.a.Column,{title:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",dataIndex:"endDate",width:"10%",sorter:ue,render:re}),l.a.createElement(ae.a.Column,{title:"\u0422\u0438\u043f",dataIndex:"type",width:"10%",filters:d.map((function(e){return{value:e.id,text:e.type}})),onFilter:function(e,t){return t.type.id===e},render:ce}),l.a.createElement(ae.a.Column,{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",dataIndex:"persons",width:"15%",render:oe}),l.a.createElement(ae.a.Column,{title:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",dataIndex:"toponyms",width:"15%",render:le}),l.a.createElement(ae.a.Column,{title:"",key:"delete",render:function(e,t){return l.a.createElement(te.a,{title:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",onConfirm:function(e){e.stopPropagation(),a(t)},onCancel:function(e){e.stopPropagation()},okText:"\u0414\u0430",cancelText:"\u041d\u0435\u0442"},l.a.createElement(Z.a,{type:"link",onClick:function(e){e.stopPropagation()}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))}})))},de=n(162),me=n(534),pe=n(530),be=n(525),fe=n(14),Oe=n.n(fe),je=n(82),ve=n(144),Ee=n(527),ye=function(e){var t=e.dateFormat,n=void 0===t?"DD.MM.YYYY":t,a=Object(je.a)(e,["dateFormat"]);return l.a.createElement(Ee.a,Object.assign({format:n},a))},he=n(121),ge=function(e){return e.id},De=function(e){return e.name},Ce=[],we=function(e){var t=e.options,n=void 0===t?Ce:t,a=e.optionKeyFactory,r=void 0===a?ge:a,c=e.optionValueFactory,o=void 0===c?ge:c,i=e.optionNameFactory,u=void 0===i?De:i,s=Object(je.a)(e,["options","optionKeyFactory","optionValueFactory","optionNameFactory"]);return l.a.createElement(he.a,s,n.map((function(e){return l.a.createElement(he.a.Option,{key:r(e),value:o(e)},u(e))})))},xe=n(531),ke=[],Se=function(e){var t=e.allOptions,n=e.value,a=void 0===n?ke:n,r=e.onChange,c=e.placeholder,i=e.count,u=void 0===i?5:i,s=e.optionKeyFactory,d=void 0===s?ge:s,m=e.optionValueFactory,p=void 0===m?ge:m,f=e.optionNameFactory,O=void 0===f?De:f,j=Object(o.useState)([]),v=Object(N.a)(j,2),E=v[0],y=v[1],h=Object(o.useCallback)(Object(ee.a)((function(e){y(t.filter((function(t){return O(t).toLowerCase().includes(e.toLocaleLowerCase())})))}),300),[t]),g=Object(o.useCallback)((function(){y([])}),[]),D=Object(o.useCallback)((function(e){y([]),r(e)}),[r]),C=Object(o.useMemo)((function(){return a.map((function(e){return t.find((function(t){return p(t)===e}))}))}),[t,a,p]),w=Object(o.useMemo)((function(){return E.length?E.slice(0,u):Object(xe.a)([].concat(Object(b.a)(t.slice(0,u)),Object(b.a)(C)))}),[t,u,E,C]),x=Object(o.useMemo)((function(){return E.length?E.length-u:t.length-w.length}),[t,u,E,w.length]);return l.a.createElement(he.a,{placeholder:c,mode:"multiple",filterOption:!1,onSearch:h,onChange:D,onBlur:g,value:a},w.map((function(e){return l.a.createElement(he.a.Option,{key:d(e),value:p(e)},O(e))})),x>0&&l.a.createElement(he.a.Option,{key:"__hidedOptionsCount__",value:"__hidedOptionsCount__",disabled:!0},"\u0415\u0449\u0435 ",x," \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432"))},Fe=function(e){return function(t){var n=t.name,a=t.label,r=t.validate,c=t.allowNull,o=void 0===c||c,i=t.format,u=void 0===i?ve.a:i,s=t.parse,d=void 0===s?ve.a:s,m=Object(je.a)(t,["name","label","validate","allowNull","format","parse"]);return l.a.createElement(de.a,{name:n,format:u,parse:d,allowNull:o,validate:r},(function(t){var n=t.input,r=n.value,c=n.onChange,o=t.meta,i=o.invalid,u=o.touched,s=o.error;return l.a.createElement(pe.a.Item,{label:a,validateStatus:u&&i?"error":"success",help:s},l.a.createElement(e,Object.assign({value:r,onChange:c},m)))}))}},Ie=function(e){return function(t){var n=t.debounceTimeout,a=void 0===n?300:n,r=t.onChange,c=t.value,i=Object(je.a)(t,["debounceTimeout","onChange","value"]),u=Object(o.useState)(c),s=Object(N.a)(u,2),d=s[0],m=s[1],p=Object(o.useCallback)(Object(ee.a)((function(e){r(e)}),a),[]),b=Object(o.useCallback)((function(e){var t=e.target.value;m(t),p(t)}),[p]);return l.a.createElement(e,Object.assign({value:d,onChange:b},i))}},_e=(Fe(Ie(ne.a)),Fe(Ie(ne.a.TextArea))),Me=Fe(ye),Ne=Fe(we),Te=Fe(Se),Le=n(524),Re=n(25),Ae=function(e){return Object(Le.a)(e)||""===e||Object(Re.a)(e)&&0===e.length?"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e":void 0},ze=function(e,t){return function(n,a){return n.isBefore(a[e],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(t):void 0}},He=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e,n,a){return t.reduce((function(t,r){return t||r(e,n,a)}),void 0)}},Ke=function(e){return e.type},Ve=function(e){return"".concat(e.surname," ").concat(e.name," ").concat(e.patron)},Be={name:null,startDate:null,endDate:null,type:null,toponyms:[],persons:[]},Pe=function(e){var t=e.onSubmit,n=e.onClose,a=e.title,r=Object(s.c)(Y),c=Object(s.c)(B),o=Object(s.c)(P),i=Object(s.c)(V),u=Object(T.j)().id;if(i.length<1)return l.a.createElement("div",{style:{minHeight:200,display:"flex",alignItems:"center",justifyContent:"center"}},l.a.createElement(H.a,{size:"large"}));var d=i.find((function(e){return e.id===Number(u)})),m=d?function(e){return Object(f.a)({},e,{startDate:Oe()(e.startDate),endDate:Oe()(e.endDate)})}(d):Be;return l.a.createElement(me.a,{title:a,onClose:n,placement:"right",width:450,visible:!0,closable:!0,destroyOnClose:!0},l.a.createElement(de.b,{initialValues:m,onSubmit:function(e){t(e)}},(function(e){var t,n,a=e.handleSubmit;return l.a.createElement(pe.a,{layout:"vertical",onSubmit:a},l.a.createElement(be.a,null,l.a.createElement(_e,{name:"name",label:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",rows:4,placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",validate:Ae})),l.a.createElement(be.a,null,l.a.createElement(Me,{name:"startDate",label:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",validate:He(Ae,(t="endDate",n="\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",function(e,a){return e.isAfter(a[t],"day")?"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043c\u0435\u043d\u044c\u0448\u0435 \u0447\u0435\u043c ".concat(n):void 0}))})),l.a.createElement(be.a,null,l.a.createElement(Me,{name:"endDate",label:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",validate:He(Ae,ze("startDate","\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430"))})),l.a.createElement(be.a,null,l.a.createElement(Ne,{name:"type",label:"\u0422\u0438\u043f",options:r,optionNameFactory:Ke,validate:Ae})),l.a.createElement(be.a,null,l.a.createElement(Te,{name:"toponyms",label:"\u0422\u043e\u043f\u043e\u043d\u0438\u043c\u044b",allOptions:c,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043f\u043e\u043d\u0438\u043c\u044b"})),l.a.createElement(be.a,null,l.a.createElement(Te,{name:"persons",label:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0435 \u043b\u0438\u0446\u0430",allOptions:o,optionNameFactory:Ve,placeholder:"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u043b\u0438\u0446"})),l.a.createElement("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right"}},l.a.createElement(Z.a,{htmlType:"submit",type:"primary"},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")))})))},Ye="".concat("/editor","/add"),Je="".concat("/editor","/edit/:id"),Ue=function(){var e=Object(s.b)(),t=Object(T.h)(),n=Object(o.useCallback)((function(e){t.push(Object(T.f)(Je,{id:e.id}))}),[t]),a=Object(o.useCallback)((function(){t.push("/editor")}),[t]),r=Object(o.useCallback)((function(t){e(k(Object(f.a)({},t,{endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),a()}),[e,a]),c=Object(o.useCallback)((function(t){e(S(t))}),[e]),i=Object(o.useCallback)((function(t){e(F(Object(f.a)({},t,{id:Object(D.a)(),endDate:t.endDate.toDate(),startDate:t.startDate.toDate()}))),a()}),[a,e]),u=Object(o.useCallback)((function(){t.push(Ye)}),[t]);return l.a.createElement(L.a,null,l.a.createElement(z.a,{ghost:!1,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445",extra:l.a.createElement($,null)}),l.a.createElement(L.a.Content,null,l.a.createElement(se,{onAdd:u,onSelect:n,deleteRow:c}),l.a.createElement(T.b,{path:Ye,render:function(){return l.a.createElement(Pe,{onClose:a,onSubmit:i,title:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}}),l.a.createElement(T.b,{path:Je,render:function(){return l.a.createElement(Pe,{onClose:a,onSubmit:r,title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"})}})))},Xe=["/view","/editor"],qe=function(){var e=Object(o.useState)(!0),t=Object(N.a)(e,2),a=t[0],r=t[1],c=Object(s.b)(),i=Object(T.i)().pathname,u=Object(o.useMemo)((function(){return[Xe.find((function(e){return e===i}))]}),[i]);return Object(o.useEffect)((function(){c((function(e){var t;return v.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return e(C()),a.prev=1,a.next=4,v.a.awrap(n.e(3).then(n.t.bind(null,538,3)));case 4:t=a.sent,e(w(t)),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(1),e(x(a.t0));case 11:case"end":return a.stop()}}),null,null,[[1,8]])}))}),[c]),l.a.createElement(L.a,{style:{minHeight:"100vh"},hasSider:!0},l.a.createElement(L.a.Sider,{theme:"dark",collapsible:!0,width:240,collapsed:a,onCollapse:r,style:{overflow:"auto",height:"100vh",position:"fixed",left:0}},l.a.createElement(R.a,{theme:"dark",mode:"inline",selectedKeys:u},l.a.createElement(R.a.Item,{key:"/view"},l.a.createElement(d.b,{to:"/view"},l.a.createElement(A.a,{type:"pie-chart"}),l.a.createElement("span",null,"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u0430\u043d\u043d\u044b\u0445"))),l.a.createElement(R.a.Item,{key:"/editor"},l.a.createElement(d.b,{to:"/editor"},l.a.createElement(A.a,{type:"edit"}),l.a.createElement("span",null,"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445"))))),l.a.createElement(L.a,{style:{marginLeft:a?80:240,transition:"margin 0.2s"}},l.a.createElement(L.a.Content,null,l.a.createElement(T.d,null,l.a.createElement(T.b,{path:"/view",component:W}),l.a.createElement(T.b,{path:"/editor",component:Ue}),l.a.createElement(T.a,{to:"/view"})))))};n(516);u.a.render(l.a.createElement(d.a,null,l.a.createElement(s.a,{store:M},l.a.createElement(qe,null))),document.getElementById("root"))}},[[285,1,2]]]);
//# sourceMappingURL=main.634c12b9.chunk.js.map